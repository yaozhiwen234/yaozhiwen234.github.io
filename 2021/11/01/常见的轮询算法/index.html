<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>常见的轮询算法 | 智翁</title><meta name="keywords" content="Demo"><meta name="author" content="yaozw"><meta name="copyright" content="yaozw"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="常见的轮询算法123456789101112131415161718class ServerIps &amp;#123;    public static final Map&lt;String, Integer&gt; WEIGHT_LIST &#x3D; new HashMap&lt;&gt;();    static &amp;#123;        &#x2F;&#x2F; total weight is 50        WEI">
<meta property="og:type" content="article">
<meta property="og:title" content="常见的轮询算法">
<meta property="og:url" content="https://yaozw.top/2021/11/01/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/index.html">
<meta property="og:site_name" content="智翁">
<meta property="og:description" content="常见的轮询算法123456789101112131415161718class ServerIps &amp;#123;    public static final Map&lt;String, Integer&gt; WEIGHT_LIST &#x3D; new HashMap&lt;&gt;();    static &amp;#123;        &#x2F;&#x2F; total weight is 50        WEI">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg">
<meta property="article:published_time" content="2021-11-01T08:21:24.000Z">
<meta property="article:modified_time" content="2021-11-02T02:26:45.687Z">
<meta property="article:author" content="yaozw">
<meta property="article:tag" content="Demo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg"><link rel="shortcut icon" href="/img/1.jpg"><link rel="canonical" href="https://yaozw.top/2021/11/01/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta name="google-site-verification" content="FlAbBJEEL5a88oWaoz23DDzCaUe-V4QH-wZNPFZoGFg"/><meta name="baidu-site-verification" content="code-NTTht2wwmo"/><link rel="manifest" href="/image/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/image/pwa/2.jpg"/><link rel="icon" type="image/png" sizes="32x32" href="/image/pwa/2.jpg"/><link rel="icon" type="image/png" sizes="16x16" href="/image/pwa/2.jpg"/><link rel="mask-icon" href="/image/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bc54d197b01578db5d5c407162e5fcda";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: {"text":"I,LOVE,YOU","fontSize":"15px"},
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-02 10:26:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><style type="text/css">.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="智翁" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/theme/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/playlist/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">智翁</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/playlist/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">常见的轮询算法</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-01T08:21:24.000Z" title="发表于 2021-11-01 16:21:24">2021-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-02T02:26:45.687Z" title="更新于 2021-11-02 10:26:45">2021-11-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/">算法练习</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h4 id="常见的轮询算法"><a href="#常见的轮询算法" class="headerlink" title="常见的轮询算法"></a>常见的轮询算法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerIps</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Integer&gt; WEIGHT_LIST = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// total weight is 50</span></span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.1&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.2&quot;</span>, <span class="number">8</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.3&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.4&quot;</span>, <span class="number">6</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.5&quot;</span>, <span class="number">5</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.6&quot;</span>, <span class="number">5</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.7&quot;</span>, <span class="number">4</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.8&quot;</span>, <span class="number">7</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.9&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        WEIGHT_LIST.put(<span class="string">&quot;192.168.0.10&quot;</span>, <span class="number">9</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Random–完全随机算法"><a href="#Random–完全随机算法" class="headerlink" title="Random–完全随机算法"></a>Random–完全随机算法</h5><p>缺点：所有服务器的访问概率都是相同的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomLoadBalancing</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> randomPos = ThreadLocalRandom.current().nextInt(ServerIps.LIST.size());</span><br><span class="line">        <span class="keyword">return</span> ServerIps.LIST.get(randomPos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="WeightedRandom–加权随机算法"><a href="#WeightedRandom–加权随机算法" class="headerlink" title="WeightedRandom–加权随机算法"></a>WeightedRandom–加权随机算法</h5><p>缺点：权重低的服务器可能很长一段时间都访问不到</p>
<ul>
<li><strong>复制法实现</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeightRandomLoadBalancing</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主要的思路就是对服务进行一个复制</span></span><br><span class="line"><span class="comment">     * 当权重设置过大时，list容易被撑爆</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; iplist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        ServerIps.WEIGHT_LIST.forEach((k, v) -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (v != <span class="number">0</span>) &#123;</span><br><span class="line">                iplist.add(k);</span><br><span class="line">                v--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 随机返回一个数组的值</span></span><br><span class="line">        <span class="keyword">return</span> iplist.get(ThreadLocalRandom.current().nextInt(iplist.size()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>累加</strong> </p>
<p>平时，经常会遇到权重随机算法，从不同权重的N个元素中随机选择一个，并使得总体选择结果是按照权重分布的。如广告投放、负载均衡等。如有4个元素A、B、C、D，权重分别为1、2、3、4，随机结果中A:B:C:D的比例要为1:2:3:4。<br>总体思路：累加每个元素的权重A(1)-B(3)-C(6)-D(10)，则4个元素的的权重管辖区间分别为[0,1)、[1,3)、[3,6)、[6,10)。然后随机出一个[0,10)之间的随机数。落在哪个区间，则该区间之后的元素即为按权重命中的元素。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeightRandomLoadBalancingV2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = ServerIps.WEIGHT_LIST;</span><br><span class="line">        <span class="comment">//计算总权值</span></span><br><span class="line">        <span class="keyword">int</span> totalWeight = map.values().stream().mapToInt(p -&gt; p).sum();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//随机一个随机数</span></span><br><span class="line">        <span class="keyword">int</span> index = ThreadLocalRandom.current().nextInt(totalWeight);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历  服务  map</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            <span class="comment">//如果权重大于  索引</span></span><br><span class="line">            <span class="keyword">if</span> (entry.getValue() &gt;= index) &#123;</span><br><span class="line">                <span class="comment">// 返回这个服务</span></span><br><span class="line">                <span class="keyword">return</span> entry.getKey();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//否则，索引 = 当前索引 - 当前服务的权重</span></span><br><span class="line">            index = index - entry.getValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="RoundRobin–完全轮询算法"><a href="#RoundRobin–完全轮询算法" class="headerlink" title="RoundRobin–完全轮询算法"></a>RoundRobin–完全轮询算法</h5><p>缺点：从头到尾轮询一遍，不能根据服务器性能设置权重</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomRobin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] ipList = (String[]) ServerIps.WEIGHT_LIST.keySet().toArray();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index == ipList.length) &#123;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ipList[index++];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="WeightedRoundRobin-加权轮询算法"><a href="#WeightedRoundRobin-加权轮询算法" class="headerlink" title="WeightedRoundRobin-加权轮询算法"></a>WeightedRoundRobin-加权轮询算法</h5><p>优点：可以根据服务器性能设置访问权重</p>
<p>缺点：可能某个服务器权重大，长时间执行，遇到耗时大的请求，压力会很大</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerIps</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> totalweigth = WEIGHT_LIST.values().stream().mapToInt(v -&gt; v).sum();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> number = (index++) % totalweigth;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; ip : WEIGHT_LIST.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ip.getValue() &gt;= number) &#123;</span><br><span class="line">                <span class="keyword">return</span> ip.getKey();</span><br><span class="line">            &#125;</span><br><span class="line">            number -= ip.getValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stream.iterate(<span class="number">0</span>, x -&gt; x + <span class="number">1</span>).limit(<span class="number">20</span>).forEach(x -&gt; &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这种算法有⼀个缺点: -台服务器的权重特别⼤的时候，他需要连续的的处理请求，但是实际.上我们想达 到的效果是，对于100次请求，只要有100*8/50=16次就够了，这16次不⼀定要连续的访问，⽐如假设我们有三 台服务器servers= [A, B, C],对应的权重为weights=[5, 1, 1] ,总权重为7,那么上述这个算法的结果是: AAAAABC，那么如果能够是这么⼀个结果呢: AABACAA，把B和C平均插⼊到5个A中间，这样是⽐较均衡的 了。</p>
<h5 id="SmoothWeightedRoundRobin–平滑加权轮询算法"><a href="#SmoothWeightedRoundRobin–平滑加权轮询算法" class="headerlink" title="SmoothWeightedRoundRobin–平滑加权轮询算法"></a>SmoothWeightedRoundRobin–平滑加权轮询算法</h5><p><a href="http://aibenlin.com/algorithm/2019/07/22/algorithm-weight.html">参考文章</a></p>
<p>优点：根据权重分配服务，同时又保证权重低的服务可以被访问到</p>
<p>缺点：集群环境下，同一个用户访问无法分流到固定一台机器</p>
<p>每个服务器对应两个权重，分别为weight 和currentWeight。其中weight是固定的，currentWeight 会动态 调整，初始值为0。当有新的请求进来时，遍历服务器列表,让它的currentWeight加上⾃身权重。遍历完 成后，找到最⼤的currentWeight,并将其减去权重总和，然后返回相应的服务器即可。 服务器servers= [A, B, C],对应的权重为weights=[5, 1, 1] ,总权重为7</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmoothWeight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> weight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentWeight;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SmoothWeight</span><span class="params">(<span class="keyword">int</span> weight, <span class="keyword">int</span> currentWeight, String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">        <span class="keyword">this</span>.currentWeight = currentWeight;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerIps</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, SmoothWeight&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        map.put(<span class="string">&quot;10.180.11.126:8888&quot;</span>, <span class="keyword">new</span> SmoothWeight(<span class="number">5</span>, <span class="number">5</span>, <span class="string">&quot;10.180.11.126:8888&quot;</span>));</span><br><span class="line">        map.put(<span class="string">&quot;10.180.11.128:8888&quot;</span>, <span class="keyword">new</span> SmoothWeight(<span class="number">2</span>, <span class="number">2</span>, <span class="string">&quot;10.180.11.128:8888&quot;</span>));</span><br><span class="line">        map.put(<span class="string">&quot;10.180.11.130:8888&quot;</span>, <span class="keyword">new</span> SmoothWeight(<span class="number">9</span>, <span class="number">9</span>, <span class="string">&quot;10.180.11.130:8888&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SmoothWeight maxSmoothWeight = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> totalWeigth = map.values().stream().mapToInt(SmoothWeight::getWeight).sum();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, SmoothWeight&gt; entry : map.entrySet()) &#123;</span><br><span class="line"></span><br><span class="line">            SmoothWeight currentSmoothWeight = entry.getValue();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (maxSmoothWeight == <span class="keyword">null</span> || currentSmoothWeight.getCurrentWeight() &gt; maxSmoothWeight.getCurrentWeight()) &#123;</span><br><span class="line">                maxSmoothWeight = currentSmoothWeight;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">assert</span> maxSmoothWeight != <span class="keyword">null</span>;</span><br><span class="line">        maxSmoothWeight.setCurrentWeight(maxSmoothWeight.getCurrentWeight() - totalWeigth);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, SmoothWeight&gt; entry : map.entrySet()) &#123;</span><br><span class="line"></span><br><span class="line">            SmoothWeight currentSmoothWeight = entry.getValue();</span><br><span class="line"></span><br><span class="line">            currentSmoothWeight.setCurrentWeight(currentSmoothWeight.getCurrentWeight() + currentSmoothWeight.getWeight());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxSmoothWeight.getAddress();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Stream.iterate(<span class="number">0</span>, x -&gt; x + <span class="number">1</span>).limit(<span class="number">15</span>).forEach(v -&gt; &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="ConsistentHash–⼀致性哈希算法"><a href="#ConsistentHash–⼀致性哈希算法" class="headerlink" title="ConsistentHash–⼀致性哈希算法"></a>ConsistentHash–⼀致性哈希算法</h5><p>服务器集群接收到⼀次请求调⽤时，可以根据根据请求的信息，⽐如客户端的ip地址，或请求路径与请求参数 等信息进⾏哈希，可以得出⼀个哈希值，特点是对于相同的ip地址，或请求路径和请求参数哈希出来的值是样的，只要能再增加⼀个算法，能够把这个哈希值映射成⼀个服务端ip地址，就可以使相同的请求(相同 的ip 地址，或请求路径和请求参数)落到同⼀服务器上。 因为客户端发起的请求情况是⽆穷⽆尽的(客户端地址不同，请求参数不同等等)，所以对于的哈希值也是⽆ 穷⼤的，所以我们不可能把所有的哈希值都进⾏映射到服务端ip上，所以这⾥需要⽤到哈希环。如下图</p>
<p><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/%E5%93%88%E5%B8%8C%E4%B8%80%E8%87%B4%E7%AE%97%E6%B3%95/1.png" alt="image-20211029170319777"></p>
<ul>
<li><p>哈希值如果需要ip1和ip2之间的，则应该选择ip2作为结果; </p>
</li>
<li><p>哈希值如果需要ip2和ip3之间的，则应该选择ip3作为结果; </p>
</li>
<li><p>哈希值如果需要ip3和ip4之间的，则应该选择ip4作为结果; </p>
</li>
<li><p>哈希值如果需要ip4和ip1之间的，则应该选择ip1作为结果; </p>
<p>上⾯这情况是⽐较均匀情况，如果出现ip4服务器不存在，那就是这样了:</p>
</li>
</ul>
<p><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/%E5%93%88%E5%B8%8C%E4%B8%80%E8%87%B4%E7%AE%97%E6%B3%95/2.png" alt="image-20211029170522157"></p>
<p>会发现，ip3和ip1 直接的范围是⽐较⼤的，会有更多的请求落在ip1上，这是不“公平的”，解决这个问题需要加 ⼊虚拟节点，⽐如:</p>
<p><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/%E5%93%88%E5%B8%8C%E4%B8%80%E8%87%B4%E7%AE%97%E6%B3%95/3.png" alt="image-20211029170632619"></p>
<p>其中ip2-1, ip3-1就是虚拟结点，并不能处理节点，⽽是等同于对应的ip2和ip3服务器。 实际上，这只是处理这种不均衡性的⼀种思路，实际上就算哈希环本身是均衡的，你也可以增加更多的虚拟节 点来使这个环更加平滑，⽐如:</p>
<p><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/%E5%93%88%E5%B8%8C%E4%B8%80%E8%87%B4%E7%AE%97%E6%B3%95/4.png" alt="image-20211029170703312"></p>
<p>这个彩环也是“公平的”，并且只有ip1,2,3,4是实际的服务器ip,其他的都是虚拟ip。 那么我们怎么来实现呢? 对于我们的服务端ip地址，我们肯定知道总共有多少个，需要多少个虚拟节点也有我们⾃⼰控制，虚拟节点越 多则流量越均衡，另外哈希算法也是很关键的，哈希算法越散列流量也将越均衡。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerIps</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; LIST = Arrays.asList(</span><br><span class="line">            <span class="string">&quot;192.168.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.6&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.7&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.9&quot;</span>,</span><br><span class="line">            <span class="string">&quot;192.168.0.10&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConsistentHash</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SortedMap&lt;Integer, String&gt; virtualNodes = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VIRTUAL_NODES = <span class="number">160</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String ip : ServerIps.LIST) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; VIRTUAL_NODES; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> hash = getHash(ip + <span class="string">&quot;VN&quot;</span> + i);</span><br><span class="line">                virtualNodes.put(hash, ip);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">(String client)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> hash = getHash(client);</span><br><span class="line">        <span class="comment">// 等到⼤于该hash值的排好序的Map</span></span><br><span class="line">        SortedMap&lt;Integer, String&gt; subMap = virtualNodes.tailMap(hash);</span><br><span class="line">        <span class="comment">// ⼤于该Hash值的第⼀个元素的位置</span></span><br><span class="line">        Integer nodeIndex = subMap.firstKey();</span><br><span class="line">        <span class="comment">//如果不存在⼤于该hash值的元素，则返回根节点</span></span><br><span class="line">        <span class="keyword">if</span> (nodeIndex == <span class="keyword">null</span>) &#123;</span><br><span class="line">            nodeIndex = virtualNodes.firstKey();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> subMap.get(nodeIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getHash</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> p = <span class="number">16777619</span>;</span><br><span class="line">        <span class="keyword">int</span> hash = (<span class="keyword">int</span>) <span class="number">2166136261L</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">            hash = (hash ^ str.charAt(i)) * p;</span><br><span class="line">        &#125;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">13</span>;</span><br><span class="line">        hash ^= hash &gt;&gt; <span class="number">7</span>;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">3</span>;</span><br><span class="line">        hash ^= hash &gt;&gt; <span class="number">17</span>;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">if</span> (hash &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            hash = Math.abs(hash);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer(<span class="string">&quot;client&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="LeastActive–最⼩活跃算法"><a href="#LeastActive–最⼩活跃算法" class="headerlink" title="LeastActive–最⼩活跃算法"></a>LeastActive–最⼩活跃算法</h5><p>前⾯⼏种⽅法主要⽬标是使服务端分配到的调⽤次数尽量均衡，但是实际情况是这样吗?调⽤次数相同，服务器的 负载就均衡吗?当然不是，这⾥还要考虑每次调⽤的时间，⽽最⼩活跃数算法则是解决这种问题的。 活跃调⽤数越⼩，表明该服务提供者效率越⾼，单位时间内可处理更多的请求。此时应优先将请求分配给该服务提 供者。在具体实现中，每个服务提供者对应⼀个活跃数。初始情况下，所有服务提供者活跃数均为0。每收到⼀个 请求，活跃数加1，完成请求后则将活跃数减1。在服务运⾏⼀段时间后，性能好的服务提供者处理请求的速度更 快，因此活跃数下降的也越快，此时这样的服务提供者能够优先获取到新的服务请求、这就是最⼩活跃数负载均衡 算法的基本思想。除了最⼩活跃数，最⼩活跃数算法在实现上还引⼊了权重值。所以准确的来说，最⼩活跃数算 法是基于加权最⼩活跃数算法实现的。举个例⼦说明⼀下，在⼀个服务提供者集中，有两个性能优异的服务提供 者。某⼀时刻它们的活跃数相同，则会根据它们的权重去分配请求，权重越⼤，获取到新请求的概率就越⼤。如果 两个服务提供者权重相同，此时随机选择-个即可。 实现: 因为活跃数是需要服务器请求处理相关逻辑配合的，⼀次调⽤开始时活跃数+1,结束时活跃数-1，所以这⾥就不对 这部分逻辑进⾏模拟了，直接使⽤⼀个map来进⾏模拟。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerIps</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 服务器当前活跃数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Integer&gt; ACTIVITY_LIST = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.1&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.2&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.3&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.4&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.5&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.6&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.7&quot;</span>, <span class="number">4</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.8&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.9&quot;</span>, <span class="number">7</span>);</span><br><span class="line">        ACTIVITY_LIST.put(<span class="string">&quot;192.168.0.10&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeastActive</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Optional&lt;Integer&gt; minValue =</span><br><span class="line"></span><br><span class="line">                ServerIps.ACTIVITY_LIST.values().stream().min(Comparator.naturalOrder());</span><br><span class="line">        <span class="keyword">if</span> (minValue.isPresent()) &#123;</span><br><span class="line">            List&lt;String&gt; minActivityIps = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            ServerIps.ACTIVITY_LIST.forEach((ip, activity) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (activity.equals(minValue.get())) &#123;</span><br><span class="line">                    minActivityIps.add(ip);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span> (minActivityIps.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                Map&lt;String, Integer&gt; weightList = <span class="keyword">new</span> LinkedHashMap&lt;String, Integer&gt;();</span><br><span class="line">                ServerIps.WEIGHT_LIST.forEach((ip, weight) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (minActivityIps.contains(ip)) &#123;</span><br><span class="line">                        weightList.put(ip, ServerIps.WEIGHT_LIST.get(ip));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">int</span> totalWeight = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">boolean</span> sameWeight = <span class="keyword">true</span>;</span><br><span class="line">                Object[] weights = weightList.values().toArray();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; weights.length; i++) &#123;</span><br><span class="line">                    Integer weight = (Integer) weights[i];</span><br><span class="line">                    totalWeight += weight;</span><br><span class="line">                    <span class="keyword">if</span> (sameWeight &amp;&amp; i &gt; <span class="number">0</span> &amp;&amp; !weight.equals(weights[i - <span class="number">1</span>])) &#123;</span><br><span class="line">                        sameWeight = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">int</span> randomPos = ThreadLocalRandom.current().nextInt(totalWeight);</span><br><span class="line">                <span class="keyword">if</span> (!sameWeight) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (String ip : weightList.keySet()) &#123;</span><br><span class="line">                        Integer value = weightList.get(ip);</span><br><span class="line">                        <span class="keyword">if</span> (randomPos &lt; value) &#123;</span><br><span class="line">                            <span class="keyword">return</span> ip;</span><br><span class="line">                        &#125;</span><br><span class="line">                        randomPos = randomPos - value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> (String) weightList.keySet().toArray()</span><br><span class="line">                        [ThreadLocalRandom.current().nextInt(weightList.size())];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> minActivityIps.get(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String) ServerIps.WEIGHT_LIST.keySet().toArray()</span><br><span class="line">                    [ThreadLocalRandom.current().nextInt(ServerIps.WEIGHT_LIST.size())];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">130</span>; i++) &#123;</span><br><span class="line">            System.out.println(getServer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="主流框架负载均衡"><a href="#主流框架负载均衡" class="headerlink" title="主流框架负载均衡"></a>主流框架负载均衡</h4><ul>
<li>dubbo负载均衡 <a href="https://dubbo.apache.org/zh/docs/advanced/loadbalance/">https://dubbo.apache.org/zh/docs/advanced/loadbalance/</a></li>
</ul>
<table>
<thead>
<tr>
<th>算法</th>
<th>特性</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>RandomLoadBalance</td>
<td>加权随机</td>
<td>默认算法，默认权重相同</td>
</tr>
<tr>
<td>RoundRobinLoadBalance</td>
<td>加权轮询</td>
<td>借鉴于 Nginx 的平滑加权轮询算法，默认权重相 同，</td>
</tr>
<tr>
<td>LeastActiveLoadBalance</td>
<td>最少活跃优先 + 加权 随机</td>
<td>背后是能者多劳的思想</td>
</tr>
<tr>
<td>ShortestResponseLoadBalance</td>
<td>最短响应优先 + 加权 随机</td>
<td>更加关注响应速度</td>
</tr>
<tr>
<td>ConsistentHashLoadBalance</td>
<td>⼀致性 Hash</td>
<td>确定的⼊参，确定的提供者，适⽤于有状态请 求</td>
</tr>
</tbody></table>
<p><strong>Random</strong></p>
<ul>
<li><p>加权随机，按权重设置随机概率。 </p>
</li>
<li><p>在⼀个截⾯上碰撞的概率⾼，但调⽤量越⼤分布越均匀，⽽且按概率使⽤权重后也⽐较均匀，有利于动态调 整提供者权重。</p>
</li>
<li><p> 缺点：存在慢的提供者累积请求的问题，⽐如：第⼆台机器很慢，但没挂，当请求调到第⼆台时就卡在那， 久⽽久之，所有请求都卡在调到第⼆台上。 </p>
</li>
</ul>
<p><strong>RoundRobin</strong></p>
<ul>
<li><p>加权轮询，按公约后的权重设置轮询⽐率，循环调⽤节点</p>
</li>
<li><p> 缺点：同样存在慢的提供者累积请求的问题。 </p>
</li>
</ul>
<p><strong>LeastActive</strong></p>
<ul>
<li><p>加权最少活跃调⽤优先，活跃数越低，越优先调⽤，相同活跃数的进⾏加权随机。活跃数指调⽤前后计数差 （针对特定提供者：请求发送数 - 响应返回数），表示特定提供者的任务堆积量，活跃数越低，代表该提供 者处理能⼒越强。</p>
</li>
<li><p> 使慢的提供者收到更少请求，因为越慢的提供者的调⽤前后计数差会越⼤；相对的，处理能⼒越强的节点， 处理更多的请求。 </p>
</li>
</ul>
<p><strong>ShortestResponse</strong> </p>
<ul>
<li><p>加权最短响应优先，在最近⼀个滑动窗⼝中，响应时间越短，越优先调⽤。相同响应时间的进⾏加权随机。 </p>
</li>
<li><p>使得响应时间越快的提供者，处理更多的请求。 </p>
</li>
<li><p>缺点：可能会造成流量过于集中于⾼性能节点的问题。 </p>
<p>这⾥的响应时间 = 某个提供者在窗⼝时间内的平均响应时间，窗⼝时间默认是 30s。</p>
</li>
</ul>
<p><strong>ConsistentHash</strong></p>
<ul>
<li>⼀致性 Hash，相同参数的请求总是发到同⼀提供者。 </li>
<li>当某⼀台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。 </li>
<li>算法参⻅：Consistent Hashing | WIKIPEDIA 缺省只对第⼀个参数 Hash，如果要修改，请配置  &lt;dubbo:parameter key=”hash.arguments” value=”0,1” /&gt;</li>
<li>缺省⽤ 160 份虚拟节点，如果要修改，请配置 &lt;dubbo:parameter key=”hash.nodes” value=”320” /&gt;</li>
</ul>
<h4 id="Ribbon-负载均衡器-LoadBalancer-源码解析-https-blog-51cto-com-u-15077536-2608300"><a href="#Ribbon-负载均衡器-LoadBalancer-源码解析-https-blog-51cto-com-u-15077536-2608300" class="headerlink" title="Ribbon 负载均衡器 LoadBalancer 源码解析 https://blog.51cto.com/u_15077536/2608300"></a>Ribbon 负载均衡器 LoadBalancer 源码解析 <a href="https://blog.51cto.com/u_15077536/2608300">https://blog.51cto.com/u_15077536/2608300</a></h4><link rel="stylesheet" href="/css/markmap.css" type="text/css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">yaozw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yaozw.top/2021/11/01/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/">https://yaozw.top/2021/11/01/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yaozw.top" target="_blank">智翁</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Demo/">Demo</a></div><div class="post_share"><div class="social-share" data-image="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/14/Linux%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/"><img class="prev-cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux常用的命令</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/06/bitmap/"><img class="next-cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">bitmap</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/10/06/bitmap/" title="bitmap"><img class="cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-06</div><div class="title">bitmap</div></div></a></div><div><a href="/2020/11/28/java8之Stream/" title="java8之Stream"><img class="cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-28</div><div class="title">java8之Stream</div></div></a></div><div><a href="/2021/03/16/java8之Stream补充/" title="java8之Stream补充"><img class="cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-16</div><div class="title">java8之Stream补充</div></div></a></div><div><a href="/2021/01/02/java模拟浏览器做文件上传/" title="java模拟浏览器做文件上传"><img class="cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-02</div><div class="title">java模拟浏览器做文件上传</div></div></a></div><div><a href="/2021/01/07/mysql存储过程分割字符串/" title="mysql存储过程分割字符串"><img class="cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/mysql.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-07</div><div class="title">mysql存储过程分割字符串</div></div></a></div><div><a href="/2021/08/26/spring + redis 实现分布式锁/" title="spring + redis 实现分布式锁"><img class="cover" src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-26</div><div class="title">spring + redis 实现分布式锁</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/theme/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">yaozw</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div></div><a class="button--animated" id="card-info-btn" href="https://github.com/yaozhiwen234/yaozhiwen234.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">优秀的判断力来自经验，但经验来自错误的判断</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">常见的轮询算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Random%E2%80%93%E5%AE%8C%E5%85%A8%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">Random–完全随机算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WeightedRandom%E2%80%93%E5%8A%A0%E6%9D%83%E9%9A%8F%E6%9C%BA%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">WeightedRandom–加权随机算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RoundRobin%E2%80%93%E5%AE%8C%E5%85%A8%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">RoundRobin–完全轮询算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WeightedRoundRobin-%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">WeightedRoundRobin-加权轮询算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SmoothWeightedRoundRobin%E2%80%93%E5%B9%B3%E6%BB%91%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">SmoothWeightedRoundRobin–平滑加权轮询算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConsistentHash%E2%80%93%E2%BC%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">ConsistentHash–⼀致性哈希算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LeastActive%E2%80%93%E6%9C%80%E2%BC%A9%E6%B4%BB%E8%B7%83%E7%AE%97%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">LeastActive–最⼩活跃算法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">2.</span> <span class="toc-text">主流框架负载均衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ribbon-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8-LoadBalancer-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-https-blog-51cto-com-u-15077536-2608300"><span class="toc-number">3.</span> <span class="toc-text">Ribbon 负载均衡器 LoadBalancer 源码解析 https:&#x2F;&#x2F;blog.51cto.com&#x2F;u_15077536&#x2F;2608300</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/12/14/Linux%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/" title="Linux常用的命令"><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux常用的命令"/></a><div class="content"><a class="title" href="/2021/12/14/Linux%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/" title="Linux常用的命令">Linux常用的命令</a><time datetime="2021-12-14T11:39:08.000Z" title="发表于 2021-12-14 19:39:08">2021-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/01/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/" title="常见的轮询算法"><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常见的轮询算法"/></a><div class="content"><a class="title" href="/2021/11/01/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95/" title="常见的轮询算法">常见的轮询算法</a><time datetime="2021-11-01T08:21:24.000Z" title="发表于 2021-11-01 16:21:24">2021-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/06/bitmap/" title="bitmap"><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="bitmap"/></a><div class="content"><a class="title" href="/2021/10/06/bitmap/" title="bitmap">bitmap</a><time datetime="2021-10-06T03:36:53.000Z" title="发表于 2021-10-06 11:36:53">2021-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/01/java%E7%BA%BF%E7%A8%8B%E5%81%9C%E6%AD%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%9A%84%E6%96%B9%E5%BC%8F/" title="java线程停止的两种的方式"><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java线程停止的两种的方式"/></a><div class="content"><a class="title" href="/2021/10/01/java%E7%BA%BF%E7%A8%8B%E5%81%9C%E6%AD%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%9A%84%E6%96%B9%E5%BC%8F/" title="java线程停止的两种的方式">java线程停止的两种的方式</a><time datetime="2021-10-01T10:21:30.000Z" title="发表于 2021-10-01 18:21:30">2021-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/26/spring%20+%20redis%20%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="spring + redis 实现分布式锁"><img src="https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="spring + redis 实现分布式锁"/></a><div class="content"><a class="title" href="/2021/08/26/spring%20+%20redis%20%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="spring + redis 实现分布式锁">spring + redis 实现分布式锁</a><time datetime="2021-08-26T06:27:22.000Z" title="发表于 2021-08-26 14:27:22">2021-08-26</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://yaozhiwen-1304431220.cos.ap-beijing.myqcloud.com/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/images/java.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By yaozw</div><div class="framework-info"><span>框架 </span><a href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><img src="https://static.dy208.cn/o_1dfilp8ruo521thr1hvf18ji17soa.png">
<a href="http://www.beian.miit.gov.cn/"  target="_blank">陕ICP备2021002813号</a></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'h3iaduAd9mn8MBLAdM978NcA-gzGzoHsz',
      appKey: 'CwWFFV6A4Ty0MOR81ceLeMvj',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/d3@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.7.4/dist/browser/view.min.js"></script>
  <script>
      const mindmaps = document.querySelectorAll('.markmap-svg');
   
      for(const mindmap of mindmaps) {
          markmap.markmap(mindmap, JSON.parse(mindmap.innerHTML));
      }
  </script> <!-- hexo injector body_end end --></body></html>